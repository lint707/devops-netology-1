# Домашнее задание к занятию "6.4. PostgreSQL"

## Задача 1  

Используя docker поднимите инстанс PostgreSQL (версию 13). Данные БД сохраните в volume.  

Подключитесь к БД PostgreSQL используя `psql`.  
Воспользуйтесь командой `\?` для вывода подсказки по имеющимся в `psql` управляющим командам.  
![psg2](img/psg2_start.jpg)  

**Найдите и приведите** управляющие команды для:  
- вывода списка БД: `postgres=# \l`  
![psg2](img/psg2_l.jpg)  

- подключения к БД: `postgres=# \c postgres`  
![psg2](img/psg2_c.jpg)  

- вывода списка таблиц: `postgres=# \dtS`  
![psg2](img/psg2_dts.jpg)  

- вывода описания содержимого таблиц: `postgres=# \dS pg_event_trigger`  
![psg2](img/psg2_ds.jpg)  

- выхода из psql: `postgres=# \q`  
![psg2](img/psg2_q.jpg)  

## Задача 2  
Используя `psql` создайте БД `test_database`.  
![psg2](img/psg2_l2.jpg)  

Изучите [бэкап БД](https://github.com/netology-code/virt-homeworks/tree/master/06-db-04-postgresql/test_data).  

Восстановите бэкап БД в `test_database`.  
![psg2](img/psg2_bk.jpg)  

Перейдите в управляющую консоль `psql` внутри контейнера.  
Подключитесь к восстановленной БД и проведите операцию ANALYZE для сбора статистики по таблице.  
![psg2](img/psg2_cr.jpg)  

Используя таблицу [pg_stats](https://postgrespro.ru/docs/postgresql/12/view-pg-stats), найдите столбец таблицы `orders`   
с наибольшим средним значением размера элементов в байтах.  
![psg2](img/psg2_pgstats.jpg)  

## Задача 3
Архитектор и администратор БД выяснили, что ваша таблица orders разрослась до невиданных размеров и
поиск по ней занимает долгое время. Вам, как успешному выпускнику курсов DevOps в нетологии предложили
провести разбиение таблицы на 2 (шардировать на orders_1 - price>499 и orders_2 - price<=499).
Предложите SQL-транзакцию для проведения данной операции.  
![psg2](img/psg2_order.jpg)  
![psg2](img/psg2_order_sl.jpg)  

Можно ли было изначально исключить "ручное" разбиение при проектировании таблицы orders?
 - Ручного разбиения можно было исбежать, если при изначальном проектировании сделать таблицу как секционарованную.

## Задача 4
Используя утилиту `pg_dump` создайте бекап БД `test_database`.

Как бы вы доработали бэкап-файл, чтобы добавить уникальность значения столбца `title` для таблиц `test_database`?

---
